<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Roleta Russa</title>

    <style>
        body {
            background: #111;
            color: #eee;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        h1 {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .container {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .player-box {
            width: 280px;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px #000;
        }

        .player-title {
            font-size: 22px;
            margin-bottom: 10px;
        }

        .vidas {
            font-size: 28px;
            margin: 10px 0;
        }

        .perdeu {
            animation: perder 0.3s ease;
        }

        @keyframes perder {
            0% {
                transform: scale(1);
                color: #fff;
            }

            50% {
                transform: scale(1.5);
                color: red;
            }

            100% {
                transform: scale(1);
                color: #fff;
            }
        }

        /* ======== TAMBOR ======== */
        .tambor-wrapper {
            margin: 25px auto;
            width: 220px;
            height: 220px;
            position: relative;
        }

        .tambor {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 6px solid #555;
            box-shadow: 0 0 18px #000 inset;
            position: relative;
        }

        .slot {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: #333;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 1;
            transition: opacity 0.3s, background 0.2s;
        }

        .slot.active {
            background: gold;
            box-shadow: 0 0 12px gold;
        }

        /* SENTIDO HORÁRIO */
        .pos6 {
            transform: translate(-50%, -50%) translate(0, -80px);
        }

        /* CIMA */
        .pos5 {
            transform: translate(-50%, -50%) translate(69px, -40px);
        }

        /* CIMA-DIREITA */
        .pos4 {
            transform: translate(-50%, -50%) translate(69px, 40px);
        }

        /* BAIXO-DIREITA */
        .pos3 {
            transform: translate(-50%, -50%) translate(0, 80px);
        }

        /* BAIXO */
        .pos2 {
            transform: translate(-50%, -50%) translate(-69px, 40px);
        }

        /* BAIXO-ESQ */
        .pos1 {
            transform: translate(-50%, -50%) translate(-69px, -40px);
        }

        /* CIMA-ESQ */

        @keyframes spinClockwise {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(1080deg);
            }
        }

        .girar {
            animation: spinClockwise 2s ease-out;
        }

        /* MODAL DE VITÓRIA */
        #modal-vitoria {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(7px);
            justify-content: center;
            align-items: center;
        }

        #modal-conteudo {
            background: #222;
            padding: 25px;
            border-radius: 14px;
            box-shadow: 0 0 15px #000;
            font-size: 22px;
            color: #fff;
            max-width: 300px;
        }
    </style>
</head>

<body>

    <h1>Roleta Russa</h1>
    <h2 id="vez-info">Carregando…</h2>

    <div class="container">
        <div class="player-box">
            <div class="player-title">Jogador 1</div>
            <div id="vida1" class="vidas">❤️❤️❤️</div>
        </div>

        <div class="player-box">
            <div class="player-title">Jogador 2</div>
            <div id="vida2" class="vidas">❤️❤️❤️</div>
        </div>
    </div>

    <h2>Tambores</h2>

    <div class="tambor-wrapper">
        <div id="tambor" class="tambor">
            <div class="slot pos1" id="slot1"></div>
            <div class="slot pos2" id="slot2"></div>
            <div class="slot pos3" id="slot3"></div>
            <div class="slot pos4" id="slot4"></div>
            <div class="slot pos5" id="slot5"></div>
            <div class="slot pos6" id="slot6"></div>
        </div>
    </div>

    <audio id="som-tiro">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-pistol-shot-1668.mp3">
    </audio>

    <div id="modal-vitoria">
        <div id="modal-conteudo">
            <div id="texto-vitoria"></div>
            <br>
            <button onclick="fecharModal()">Fechar</button>
        </div>
    </div>

    <script>
        let lastVida1 = 3;
        let lastVida2 = 3;
        let lastTamb = 6;
        let jogoAcabou = false;

        /* Ordem correta para desaparecer: 1 → 2 → 3 → 4 → 5 → 6 */
        const ordemHorario = [1, 2, 3, 4, 5, 6];

        function atualizarTambor(qtd) {
            const tambor = document.getElementById("tambor");

            /* gira somente quando enche (qtd = 6) */
            if (qtd === 6) {
                tambor.style.animation = "none";
                tambor.offsetHeight;
                tambor.style.animation = "spinClockwise 2s ease-out";
            } else {
                tambor.style.animation = "none";
            }

            /* apaga no sentido horário (1→2→3→4→5→6) */
            ordemHorario.forEach((slotNum, index) => {
                const slot = document.getElementById("slot" + slotNum);
                slot.style.opacity = index < qtd ? "1" : "0.15";
                slot.classList.remove("active");
            });

            /* ativo = o mais distante do topo → índice qtd */
            const ativoIndex = Math.min(qtd - 1, 5);
            const ativoSlot = ordemHorario[ativoIndex];

            document.getElementById("slot" + ativoSlot).classList.add("active");
        }


        function atualizar() {
            if (jogoAcabou) return;

            fetch("interface_roleta_russa.txt?cache=" + Math.random())
                .then(r => r.text())
                .then(t => {
                    if (!t.trim()) return;

                    const linhas = t.split("\n");

                    let vez = Number(linhas[0].split(":")[1]);
                    let v1 = Number(linhas[1].split(":")[1]);
                    let v2 = Number(linhas[2].split(":")[1]);
                    let tamb = Number(linhas[3].split(":")[1]);

                    document.getElementById("vez-info").innerText = "Jogador da vez: " + vez;
                    document.getElementById("vida1").innerHTML = "❤️".repeat(v1);
                    document.getElementById("vida2").innerHTML = "❤️".repeat(v2);

                    if (tamb !== lastTamb) {
                        atualizarTambor(tamb);
                        lastTamb = tamb;
                    }

                    if (v1 < lastVida1) animacaoPerderVida("vida1");
                    if (v2 < lastVida2) animacaoPerderVida("vida2");

                    lastVida1 = v1;
                    lastVida2 = v2;

                    if (t.includes("Ganhou")) {
                        const linhasTxt = t.trim().split("\n");

                        const linhaGanhou = linhasTxt.find(l => l.includes("Ganhou"));
                        const linhaFim = linhasTxt.find(l => l.includes("Fim de jogo"));

                        const msgFinal =
                            (linhaGanhou ? linhaGanhou : "") +
                            "\n\n" +
                            (linhaFim ? linhaFim : "");

                        mostrarVitoria(msgFinal.trim());
                        jogoAcabou = true;
                    }

                });
        }

        function animacaoPerderVida(id) {
            const el = document.getElementById(id);
            el.classList.add("perdeu");
            setTimeout(() => el.classList.remove("perdeu"), 400);
        }

        function mostrarVitoria(msg) {
            document.getElementById("texto-vitoria").innerText = msg;
            document.getElementById("modal-vitoria").style.display = "flex";
        }

        function fecharModal() {
            document.getElementById("modal-vitoria").style.display = "none";
        }

        setInterval(atualizar, 200);
    </script>

</body>

</html>